<!DOCTYPE html>
<!-- Shopping.html -->
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Keto Einkaufsliste</title>
<style>
:root{--a:#15d6e1;--as:#30e5ec;--bg:#181c22;--c:#23273a;--t:#fff;--m:#91a0b5;--b:#2a2f49;--f:#7ef0f6;--rh:64px;--ts:48px;--r:12px}
*{box-sizing:border-box}
html,body{height:100%;margin:0}
html{font-size:18px}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Arial,sans-serif;background:var(--bg);color:var(--t);padding:env(safe-area-inset-top) env(safe-area-inset-right) calc(env(safe-area-inset-bottom) + 52px) env(safe-area-inset-left);min-height:100%;-webkit-text-size-adjust:100%}
.hidden{display:none!important}
header{text-align:center;padding:20px 12px 8px}
h1{color:var(--a);font-size:1.6rem;font-weight:700;margin:0 0 8px 0}
.search-bar{width:100%;max-width:420px;margin:0 auto 12px;display:flex;align-items:center;gap:8px}
#search{width:100%;padding:12px 14px;background:var(--c);border-radius:10px;border:1px solid var(--b);color:var(--t);font-size:1.05rem;outline:none}
#search::placeholder{color:var(--m)}
#search:focus{border-color:var(--f);box-shadow:0 0 0 3px color-mix(in oklab,var(--f),transparent 80%)}
.menu{display:flex;justify-content:center;gap:12px;margin-bottom:8px}
.menu-btn{background:var(--c);color:var(--t);border:1px solid var(--b);padding:10px 14px;border-radius:10px;font-size:1.05rem;cursor:pointer;touch-action:manipulation;min-width:var(--ts);min-height:var(--ts);transition:transform .06s ease-out,background .15s,border-color .15s}
.menu-btn:active{transform:scale(.98);background:color-mix(in oklab,var(--c),var(--a) 12%);border-color:var(--a)}
.menu-toggle{width:var(--ts);height:var(--ts);display:grid;place-items:center;padding:0;line-height:1}
.menu-btn:focus-visible{outline:none;box-shadow:0 0 0 3px color-mix(in oklab,var(--f),transparent 70%);border-color:var(--f)}
.category{background:var(--c);border-radius:10px;margin:0 12px 12px;border:1px solid var(--b);overflow:clip}
.cat-header{display:flex;justify-content:space-between;align-items:center;padding:10px 14px;color:var(--a);font-size:1.05rem;font-weight:650;user-select:none;cursor:pointer;min-height:var(--ts)}
.cat-header .toggle{font-size:1.2rem;color:var(--m)}
.cat-items{padding:2px 14px 6px 20px}
.item-row{display:grid;grid-template-columns:var(--ts) 1fr;align-items:center;gap:10px;border-bottom:1px solid var(--b);min-height:var(--rh);height:var(--rh);will-change:background-color}
.item-row:last-child{border-bottom:none}
.item-row.selected{background:color-mix(in oklab,var(--as),white 75%);color:#0c0c0c}
.item-row label{display:block;cursor:pointer;font-size:1.12rem;line-height:1.15;padding:8px 0}
.item-amount{color:var(--m);font-size:1.02rem;margin-right:8px}
.checkbox{appearance:none;-webkit-appearance:none;inline-size:var(--ts);block-size:var(--ts);min-width:var(--ts);min-height:var(--ts);display:grid;place-items:center;border-radius:50%;border:2px solid var(--a);background:var(--c);cursor:pointer;position:relative;margin:0;transition:background-color 120ms ease,border-color 120ms ease}
.checkbox:focus-visible{outline:none;box-shadow:0 0 0 3px color-mix(in oklab,var(--f),transparent 70%);border-color:var(--f)}
.checkbox:checked{background:var(--a);border-color:var(--as)}
.checkbox:checked::before{content:"‚úì";color:#0c0c0c;font-weight:800;font-size:1.2rem;position:absolute;line-height:1}
.status-wrap{position:fixed;left:0;right:0;bottom:0;padding-bottom:env(safe-area-inset-bottom);z-index:50}
.status-bar{background:var(--c);color:var(--a);font-weight:650;text-align:center;padding:12px 0;font-size:1.05rem;border-top:1px solid var(--b)}
.sr-live{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
@media (max-width:420px){h1{font-size:1.45rem}}
@media (prefers-reduced-motion:reduce){*{animation:none!important;transition:none!important;scroll-behavior:auto!important}}
</style>
</head>
<body>
<header>
<h1>Einkaufsliste</h1>
<div class="search-bar">
<input id="search" type="search" placeholder="üîç Artikel/Kategorie suchen‚Ä¶" autocomplete="off" enterkeyhint="search">
<button class="menu-btn menu-toggle" id="menu" aria-haspopup="true" aria-expanded="false">‚ãØ</button>
</div>
<div class="menu hidden" id="menuPopup" role="menu">
<button class="menu-btn" id="showSelected" role="menuitem">üìã Nur Auswahl</button>
<button class="menu-btn" id="sendList" role="menuitem">üì§ Auswahl senden</button>
<button class="menu-btn" id="resetList" role="menuitem">üóëÔ∏è Zur√ºcksetzen</button>
</div>
</header>
<main id="list"></main>
<div class="status-wrap">
<p class="sr-live" aria-live="polite" id="liveCounter"></p>
<div class="status-bar" id="statusBar">0 ausgew√§hlt ¬∑ 0 sichtbar</div>
</div>
<script>
const d=`Kategorie,Menge,Bezeichnung
Obst & Gem√ºse,"1,2 kg",Brokkoli frisch
,"1,0 kg",Blumenkohl
,"1,5 kg",Zucchini
,600 g,Spinat  (oder Bio Blattspinat TK 2√ó)
,6 Stk,Paprika Mix
,500 g,Champignons
,250 g,Rucola
,6 Stk,Tomaten
,2 Stk,Gurken
,6 Stk,Zwiebeln
,,Knoblauch 1 Knolle
,4 Stk,Zitronen
,1 kg,Beeren-Mix TK
,2 Stk,Avocado
,1 Bund,"Petersilie, Dill, Schnittlauch je"
Milchprodukte & Eier,500 g,Skyr natur  Becher ()
,1 kg,Magerquark
,1 kg,Griechisches Joghurt 10%
,500 g,Cottage Cheese (H√ºttenk√§se)
,200 g,Gouda 6 Monate gereift
,150 g,Parmesan am St√ºck
,20 Stk,Freilandeier
,250 g,Ja! Nat√ºrlich Weidebutter
Fleisch & Fisch,"1,6 kg",H√ºhnerfilet
,800 g,Rind Faschiertes mager
,600 g,Lachsfilet TK
,600 g,Seehechtfilet TK
,500 g,Garnelen gesch√§lt TK
,3 Dosen,Thunfisch in Wasser
,1 Glas,Sardellenfilets
Vorrat & Feinkost,200 g,Gr√ºne Oliven entsteint
,1 Glas,Pesto alla Genovese (zuckerarm)
,500 ml,Passierte Tomaten
,250 ml,Sojasauce
,500 ml,Bio Oliven√∂l Extra Vergine
,250 ml,Kokos√∂l
,200 g,Bio Leinsamen  oder Chiasamen
,150 g,Pekann√ºsse
,150 g,Paran√ºsse
,100 g,Kakao-Nibs
,,"Gew√ºrze: Salz, Pfeffer, Paprika, Chili, Knoblauchpulver, Zimt"
,,S√º√üstoff / FlavDrops
,270 g,Kajnok Slim Nudeln  (Konjaknudeln)
Tiefk√ºhl,450 g,Bio Blattspinat  ()
,2 Beutel,Blumenkohlreis TK
,1 kg,Beeren-Mix TK`;

function parseCSV(data){
const lines=data.split("\n").slice(1);
const categories={};
let currentCat="";
for(const line of lines){
const parts=line.split(/,(?=(?:[^"]*"[^"]*")*[^"]*$)/g).map(s=>s.replace(/^"|"$/g,"").trim());
let[cat,menge,bez]=parts;
if(cat)currentCat=cat;
if(!categories[currentCat])categories[currentCat]=[];
if(bez)categories[currentCat].push({amount:menge,name:bez});
}
return categories;
}

const categories=parseCSV(d);
const LS_SELECTED="ek_selected";
const LS_COLLAPSED="ek_collapsed";
const LS_ONLYSEL="ek_onlySelected";
const LS_FILTER="ek_filter";

let selected=JSON.parse(localStorage.getItem(LS_SELECTED)||"{}");
let collapsed=JSON.parse(localStorage.getItem(LS_COLLAPSED)||"{}");
let onlySelected=JSON.parse(localStorage.getItem(LS_ONLYSEL)||"false");
let filter=localStorage.getItem(LS_FILTER)||"";

function saveLocal(){
localStorage.setItem(LS_SELECTED,JSON.stringify(selected));
localStorage.setItem(LS_COLLAPSED,JSON.stringify(collapsed));
localStorage.setItem(LS_ONLYSEL,JSON.stringify(onlySelected));
localStorage.setItem(LS_FILTER,filter);
}

const listEl=document.getElementById("list");
const statusEl=document.getElementById("statusBar");
const liveEl=document.getElementById("liveCounter");
const searchEl=document.getElementById("search");

searchEl.value=filter;

function itemMatchesFilter(cat,item){
if(!filter)return true;
const t=(item.name+" "+(item.amount||"")+" "+cat).toLowerCase();
return t.includes(filter.toLowerCase());
}

function computeVisibleAndSelected(){
let visible=0,sel=0;
for(const[cat,items]of Object.entries(categories)){
for(const item of items){
const key=cat+"|"+item.name;
const inFilter=itemMatchesFilter(cat,item);
const inOnly=!onlySelected||!!selected[key];
if(inFilter&&inOnly){
visible++;
if(selected[key])sel++;
}
}
}
return{visible,sel};
}

function updateStatus(){
const{visible,sel}=computeVisibleAndSelected();
const text=`${sel} ausgew√§hlt ¬∑ ${visible} sichtbar`;
statusEl.textContent=text;
liveEl.textContent=text;
}

function renderList(){
listEl.innerHTML="";
for(const[cat,items]of Object.entries(categories)){
const shownItems=items.filter(it=>itemMatchesFilter(cat,it)&&(!onlySelected||selected[cat+"|"+it.name]));
if(!shownItems.length)continue;

const catDiv=document.createElement("section");
catDiv.className="category";
const isCollapsed=onlySelected?false:!!collapsed[cat];
catDiv.innerHTML=`<div class="cat-header" data-cat="${cat}" aria-expanded="${!isCollapsed}"><span>${cat}</span><span class="toggle" aria-hidden="true">${isCollapsed?"‚ñº":"‚ñ≤"}</span></div><div class="cat-items ${isCollapsed?"hidden":""}"></div>`;

const itemsWrap=catDiv.querySelector(".cat-items");
for(const item of shownItems){
const key=cat+"|"+item.name;
const checked=!!selected[key];

const row=document.createElement("div");
row.className="item-row"+(checked?" selected":"");
row.dataset.key=key;

const cb=document.createElement("input");
cb.type="checkbox";
cb.className="checkbox";
cb.id=key;
cb.checked=checked;
cb.setAttribute("aria-label",item.name);

const label=document.createElement("label");
label.htmlFor=key;
label.innerHTML=`<span class="item-amount">${item.amount?item.amount:""}</span>${item.name}`;

row.appendChild(cb);
row.appendChild(label);
itemsWrap.appendChild(row);
}
listEl.appendChild(catDiv);
}
updateStatus();
}

listEl.addEventListener("change",e=>{
if(!(e.target instanceof HTMLInputElement))return;
if(!e.target.classList.contains("checkbox"))return;

const key=e.target.id;
const checked=e.target.checked;
selected[key]=checked;

const row=e.target.closest(".item-row");
if(row)row.classList.toggle("selected",checked);

saveLocal();
updateStatus();

if(onlySelected&&!checked){
const rowEl=row;
if(rowEl){
rowEl.style.opacity="0";
rowEl.style.transition="opacity 120ms ease";
setTimeout(()=>{
const wrapper=rowEl.closest(".cat-items");
rowEl.remove();
if(wrapper&&!wrapper.children.length){
wrapper.closest(".category")?.remove();
}
updateStatus();
},120);
}
}
});

listEl.addEventListener("click",e=>{
const header=e.target.closest(".cat-header");
if(!header)return;

const cat=header.dataset.cat;
const section=header.parentElement;
const items=section.querySelector(".cat-items");
const toggleIcon=header.querySelector(".toggle");

const newCollapsed=!collapsed[cat];
collapsed[cat]=newCollapsed;
items.classList.toggle("hidden",newCollapsed);
header.setAttribute("aria-expanded",String(!newCollapsed));
toggleIcon.textContent=newCollapsed?"‚ñº":"‚ñ≤";

saveLocal();
});

document.getElementById("search").addEventListener("input",e=>{
filter=e.target.value;
saveLocal();
renderList();
});

const menuBtn=document.getElementById("menu");
const menu=document.getElementById("menuPopup");
const openMenu=()=>{menu.classList.remove("hidden");menuBtn.setAttribute("aria-expanded","true");};
const closeMenu=()=>{menu.classList.add("hidden");menuBtn.setAttribute("aria-expanded","false");};

menuBtn.addEventListener("click",()=>{menu.classList.contains("hidden")?openMenu():closeMenu();});
document.addEventListener("click",e=>{
if(!menu.contains(e.target)&&e.target!==menuBtn&&!menuBtn.contains(e.target))closeMenu();
});

document.getElementById("showSelected").addEventListener("click",()=>{
onlySelected=!onlySelected;
saveLocal();
renderList();
closeMenu();
});

document.getElementById("sendList").addEventListener("click",async()=>{
const selectedByCat={};
Object.entries(selected).filter(([,v])=>v).forEach(([k])=>{
const[cat,name]=k.split("|");
if(!selectedByCat[cat])selectedByCat[cat]=[];
selectedByCat[cat].push(name);
});

const lines=[];
Object.entries(selectedByCat).forEach(([cat,items])=>{
lines.push(`${cat}:`);
items.forEach(item=>lines.push(`  ${item}`));
lines.push("");
});

const payload=lines.join("\n").trim()||"Keine Auswahl";
try{
if(navigator.share){
await navigator.share({title:"Meine Einkaufsliste",text:payload});
}else if(navigator.clipboard&&window.isSecureContext){
await navigator.clipboard.writeText(payload);
alert("Liste in die Zwischenablage kopiert.");
}else{
window.location.href="mailto:?subject=Einkaufsliste&body="+encodeURIComponent(payload);
}
}catch{}
closeMenu();
});

document.getElementById("resetList").addEventListener("click",()=>{
selected={};
filter="";
onlySelected=false;
document.getElementById("search").value="";
saveLocal();
renderList();
closeMenu();
});

renderList();
</script>
</body>
</html>
